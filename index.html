<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hana Photo Search (Real Cloud)</title>
    
    <!-- 1. ‡πÑ‡∏•‡∏ö‡∏£‡∏≤‡∏£‡∏µ‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>
    
    <!-- 2. Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    
    <!-- 3. ‡∏ü‡∏≠‡∏ô‡∏ï‡πå -->
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&family=Fredoka:wght@400;500;600&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Kanit', sans-serif; background-color: #f8fafc; }
        .font-cute { font-family: 'Fredoka', sans-serif; }
        .scan-container { position: relative; overflow: hidden; }
        .scan-line {
            width: 100%; height: 4px; background: #3b82f6;
            box-shadow: 0 0 15px #3b82f6, 0 0 30px #60a5fa;
            position: absolute; top: 0; left: 0; z-index: 20;
            animation: scan 1.5s infinite linear;
        }
        @keyframes scan { 0% { top: 0%; opacity: 0; } 20% { opacity: 1; } 80% { opacity: 1; } 100% { top: 100%; opacity: 0; } }
        .glass-panel { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border-bottom: 1px solid rgba(255, 255, 255, 0.5); }
        .fade-in { animation: fadeIn 0.6s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        #overlay-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 10; pointer-events: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;
        const { createRoot } = ReactDOM;

        // ==================================================================
        // üî¥ 1. FIREBASE CONFIG (‡πÉ‡∏™‡πà‡πÉ‡∏´‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå upload-faces.js ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì)
        // ==================================================================
        const firebaseConfig = {
            apiKey: "AIzaSyCyYl8IcdzNQEaf6hW6HTyUj2-IJ1eBZS8",
            authDomain: "rba-exam-system.firebaseapp.com",
            projectId: "rba-exam-system",
            storageBucket: "rba-exam-system.firebasestorage.app",
            messagingSenderId: "1079726117155",
            appId: "1:1079726117155:web:d1dc94bfc060a76891fc96"
        };

        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.firestore();

        // --- Icons ---
        const Icon = ({ children, className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>;
        const Cloud = () => <Icon className="w-6 h-6"><path d="M17.5 19c0-1.7-1.3-3-3-3h-1.1c-.1-2.9-2.4-5.1-5.3-5.1-2.5 0-4.6 1.7-5.1 4.1C1.3 15.4 0 17 0 19c0 2.8 2.2 5 5 5h12.5c2.8 0 5-2.2 5-5 0-2.6-1.9-4.7-4.4-5z"/></Icon>;
        const Camera = () => <Icon><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/></Icon>;
        const Download = () => <Icon className="w-5 h-5"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></Icon>;
        const Folder = () => <Icon className="w-6 h-6"><path d="M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 2H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z"/></Icon>;
        const User = () => <Icon className="w-5 h-5"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></Icon>;
        const Grid = () => <Icon className="w-5 h-5"><rect width="7" height="7" x="3" y="3" rx="1"/><rect width="7" height="7" x="14" y="3" rx="1"/><rect width="7" height="7" x="14" y="14" rx="1"/><rect width="7" height="7" x="3" y="14" rx="1"/></Icon>;
        const X = () => <Icon className="w-5 h-5"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></Icon>;
        const CheckCircle = () => <Icon className="w-8 h-8"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></Icon>;
        const UploadIcon = () => <Icon className="w-12 h-12"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></Icon>;
        const ChevronDown = () => <Icon className="w-5 h-5"><path d="m6 9 6 6 6-6"/></Icon>;

        const App = () => {
            const [activeTab, setActiveTab] = useState('home');
            const [uploadImage, setUploadImage] = useState(null);
            const [isScanning, setIsScanning] = useState(false);
            const [searchResults, setSearchResults] = useState([]);
            const [modelsLoaded, setModelsLoaded] = useState(false);
            const [systemStatus, setSystemStatus] = useState("‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏∞‡∏ö‡∏ö...");
            
            // Database & AI Data
            const [dbImages, setDbImages] = useState([]);
            const [visibleCounts, setVisibleCounts] = useState({});
            const [faceMatcher, setFaceMatcher] = useState(null);

            const imgRef = useRef();
            const canvasRef = useRef();

            // ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ (0.45 = ‡∏Ñ‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥)
            const MATCH_THRESHOLD = 0.45; 

            // 1. ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö: ‡πÇ‡∏´‡∏•‡∏î AI ‡πÅ‡∏•‡∏∞ ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Firebase
            useEffect(() => {
                const initSystem = async () => {
                    try {
                        setSystemStatus("‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏°‡πÄ‡∏î‡∏• AI...");
                        const MODEL_URL = 'https://justadudewhohacks.github.io/face-api.js/models';
                        await Promise.all([
                            faceapi.nets.ssdMobilenetv1.loadFromUri(MODEL_URL), 
                            faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL),
                            faceapi.nets.faceRecognitionNet.loadFromUri(MODEL_URL),
                        ]);
                        console.log("AI Loaded");

                        setSystemStatus("‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Cloud...");
                        
                        // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å Firebase (Cloud Firestore)
                        // ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÄ‡∏≠‡∏á‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡∏≠‡∏µ‡∏Å‡πÅ‡∏•‡πâ‡∏ß
                        const snapshot = await db.collection('face_descriptors').get();
                        
                        if (snapshot.empty) {
                            setSystemStatus("‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡πÅ‡∏ï‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Firebase ‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß)");
                            setModelsLoaded(true);
                            return;
                        }

                        const images = [];
                        const labeledDescriptors = [];

                        snapshot.forEach(doc => {
                            const data = doc.data();
                            images.push(data);
                            
                            // ‡πÄ‡∏Å‡πá‡∏ö Descriptor ‡πÑ‡∏ß‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
                            if (data.descriptor && data.descriptor.length > 0) {
                                const floatArray = new Float32Array(data.descriptor);
                                labeledDescriptors.push(new faceapi.LabeledFaceDescriptor(data.url, [floatArray]));
                            }
                        });

                        setDbImages(images);
                        setSystemStatus(`‚úÖ ‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (${images.length} ‡∏£‡∏π‡∏õ‡∏à‡∏≤‡∏Å Cloud)`);
                        setModelsLoaded(true);

                    } catch (e) { 
                        console.error(e); 
                        setSystemStatus("‚ùå ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ: " + e.message); 
                        setModelsLoaded(true);
                    }
                };
                initSystem();
            }, []);

            // ‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ï‡∏≤‡∏°‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ Gallery)
            const groupedImages = useMemo(() => {
                const groups = {};
                dbImages.forEach(img => {
                    const folder = img.folder || "General";
                    if (!groups[folder]) groups[folder] = [];
                    groups[folder].push(img);
                });
                return groups;
            }, [dbImages]);

            // 2. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤ (Real Matching)
            const detectAndMatchFace = async () => {
                if (imgRef.current && canvasRef.current && dbImages.length > 0) {
                    const img = imgRef.current;
                    
                    try {
                        // ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤
                        const detection = await faceapi.detectSingleFace(img, new faceapi.SsdMobilenetv1Options({ minConfidence: 0.5 })).withFaceLandmarks().withFaceDescriptor();
                        
                        if (detection) {
                            setSystemStatus("‚úÖ ‡πÄ‡∏à‡∏≠‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤! ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...");
                            
                            const displaySize = { width: img.offsetWidth, height: img.offsetHeight };
                            faceapi.matchDimensions(canvasRef.current, displaySize);
                            const resized = faceapi.resizeResults(detection, displaySize);
                            const ctx = canvasRef.current.getContext('2d');
                            ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);
                            faceapi.draw.drawDetections(canvasRef.current, resized);

                            // ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô
                            const inputDescriptor = detection.descriptor;
                            const matches = [];

                            dbImages.forEach(dbImg => {
                                // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏£‡∏π‡∏õ‡πÉ‡∏ô DB ‡∏°‡∏µ‡∏£‡∏´‡∏±‡∏™‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÑ‡∏´‡∏°
                                if(dbImg.descriptor && dbImg.descriptor.length > 0) {
                                    const dbDescriptor = new Float32Array(dbImg.descriptor);
                                    // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á (Euclidean Distance)
                                    const distance = faceapi.euclideanDistance(inputDescriptor, dbDescriptor);
                                    
                                    // ‡∏ñ‡πâ‡∏≤‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏Å‡∏ì‡∏ë‡πå (0.45) ‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤‡πÉ‡∏ä‡πà
                                    if (distance < MATCH_THRESHOLD) { 
                                        matches.push({ 
                                            ...dbImg, 
                                            distance, 
                                            score: ((1 - (distance / MATCH_THRESHOLD)) * 100).toFixed(0)
                                        });
                                    }
                                }
                            });

                            // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏°‡∏≤‡∏Å‡πÑ‡∏õ‡∏ô‡πâ‡∏≠‡∏¢
                            matches.sort((a, b) => a.distance - b.distance);

                            setIsScanning(false);
                            setSearchResults(matches);
                            
                            if (matches.length > 0) setSystemStatus(`üéâ ‡πÄ‡∏à‡∏≠‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô ${matches.length} ‡∏£‡∏π‡∏õ`);
                            else {
                                setSystemStatus("‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô");
                                alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏±‡∏ö (‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏Å‡∏ì‡∏ë‡πå)");
                            }

                        } else {
                            setSystemStatus("‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏ô‡∏£‡∏π‡∏õ");
                            alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡∏ô‡∏µ‡πâ‡∏Ñ‡∏£‡∏±‡∏ö ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏ä‡πâ‡∏£‡∏π‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏£‡∏á‡∏ó‡∏µ‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô");
                            setIsScanning(false);
                        }
                    } catch (err) {
                        console.error(err);
                        setSystemStatus("‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•");
                        setIsScanning(false);
                    }
                } else {
                    if(dbImages.length === 0) alert("‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÇ‡∏´‡∏•‡∏î ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•");
                }
            };

            const handleFileUpload = (event) => {
                const file = event.target.files[0];
                if (file) {
                    setUploadImage(URL.createObjectURL(file));
                    setIsScanning(true);
                    setSearchResults([]);
                    setSystemStatus("üîç ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå...");
                }
            };

            const onImageLoad = () => setTimeout(() => detectAndMatchFace(), 500);
            const loadMore = (folder) => setVisibleCounts(prev => ({ ...prev, [folder]: (prev[folder] || 12) + 12 }));
            const handleDownload = (url) => window.open(url, '_blank');
            const handleDownloadAll = () => {
                if (searchResults.length === 0) return;
                alert(`‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏ó‡πá‡∏ö‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î ${searchResults.length} ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û...`);
                searchResults.forEach(img => window.open(img.url, '_blank'));
            };

            return (
                <div className="min-h-screen flex flex-col text-slate-700 bg-[#f8fafc]">
                    <nav className="glass-panel sticky top-0 z-50 shadow-sm">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <div className="flex justify-between h-20 items-center">
                                <div className="flex items-center gap-2 cursor-pointer" onClick={() => setActiveTab('home')}>
                                    <div className="bg-gradient-to-tr from-blue-400 to-blue-600 p-2 rounded-xl text-white shadow-lg shadow-blue-200"><Cloud /></div>
                                    <div><h1 className="text-2xl font-bold text-blue-600 font-cute tracking-wide">Hana photo</h1><p className="text-xs text-blue-400 -mt-1">AI Real Database System</p></div>
                                </div>
                                <div className="hidden md:flex space-x-4">
                                    <button onClick={() => setActiveTab('home')} className={`px-6 py-2 rounded-full font-medium transition-all duration-200 ${activeTab === 'home' ? 'bg-blue-100 text-blue-600' : 'text-slate-500 hover:text-blue-500'}`}>‡πÅ‡∏Å‡∏•‡πÄ‡∏•‡∏≠‡∏£‡∏µ‡πà</button>
                                    <button onClick={() => setActiveTab('search')} className={`px-6 py-2 rounded-full font-medium transition-all duration-200 flex items-center gap-2 ${activeTab === 'search' ? 'bg-blue-600 text-white shadow-md shadow-blue-200' : 'text-slate-500 hover:text-blue-500'}`}><User /> ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏£‡∏π‡∏õ‡∏â‡∏±‡∏ô</button>
                                </div>
                            </div>
                        </div>
                    </nav>

                    <main className="flex-grow container mx-auto px-4 py-8">
                        {activeTab === 'home' && (
                            <div className="space-y-12 fade-in">
                                <div className="text-center space-y-4 py-10">
                                    <h2 className="text-4xl md:text-5xl font-bold text-slate-800">‡∏Ñ‡∏•‡∏±‡∏á‡∏†‡∏≤‡∏û‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå <span className="text-blue-500">(‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏£‡∏¥‡∏á)</span></h2>
                                    <p className="text-slate-500 max-w-2xl mx-auto text-lg">‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Firebase ‡πÅ‡∏•‡∏∞‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏£‡∏¥‡∏á 100%</p>
                                    <button onClick={() => setActiveTab('search')} className="mt-6 px-8 py-4 bg-blue-500 hover:bg-blue-600 text-white rounded-2xl font-bold text-lg shadow-xl shadow-blue-200 transition-transform hover:-translate-y-1 flex items-center gap-3 mx-auto"><Camera /> ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏£‡∏π‡∏õ‡∏î‡πâ‡∏ß‡∏¢‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤</button>
                                </div>

                                {dbImages.length === 0 && (
                                    <div className="text-center py-20">
                                        <div className="w-16 h-16 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin mx-auto mb-4"></div>
                                        <p className="text-slate-500">{systemStatus}</p>
                                        <p className="text-xs text-slate-400 mt-2">(‡∏´‡∏≤‡∏Å‡∏Ñ‡πâ‡∏≤‡∏á‡∏ô‡∏≤‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Firebase Config ‡∏´‡∏£‡∏∑‡∏≠ Internet)</p>
                                    </div>
                                )}

                                {Object.keys(groupedImages).map((folder) => {
                                    const images = groupedImages[folder];
                                    const limit = visibleCounts[folder] || 12;
                                    return (
                                        <div key={folder} className="bg-white rounded-2xl p-6 shadow-sm border border-slate-100 mb-8">
                                            <div className="flex items-center justify-between mb-6 pb-2 border-b border-slate-100">
                                                <div className="flex items-center gap-3">
                                                    <div className="bg-blue-100 p-2 rounded-lg text-blue-600"><Folder /></div>
                                                    <div><h3 className="text-xl font-bold text-slate-700">{folder}</h3><p className="text-xs text-slate-400">{images.length} ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</p></div>
                                                </div>
                                            </div>
                                            <div className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
                                                {images.slice(0, limit).map((img, idx) => (
                                                    <div key={idx} className="group relative aspect-[3/4] rounded-xl overflow-hidden bg-slate-100 cursor-pointer hover:shadow-lg transition-all">
                                                        <img src={img.url} loading="lazy" alt="Gallery" className="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110" />
                                                        <div className="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent opacity-0 group-hover:opacity-100 transition-opacity flex items-end justify-center p-4">
                                                            <button onClick={() => handleDownload(img.url)} className="bg-white/90 text-slate-800 p-2 rounded-full hover:bg-white shadow-lg"><Download /></button>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                            {images.length > limit && (
                                                <div className="text-center mt-6">
                                                    <button onClick={() => loadMore(folder)} className="text-blue-500 hover:text-blue-700 font-medium flex items-center gap-2 mx-auto py-2 px-4 rounded-full hover:bg-blue-50 transition-colors">‡∏î‡∏π‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° <ChevronDown /></button>
                                                </div>
                                            )}
                                        </div>
                                    );
                                })}
                            </div>
                        )}

                        {activeTab === 'search' && (
                            <div className="max-w-4xl mx-auto space-y-8 fade-in">
                                <div className={`relative overflow-hidden rounded-3xl transition-all duration-500 ${uploadImage ? 'bg-white shadow-lg' : 'bg-blue-50 border-2 border-dashed border-blue-300 hover:border-blue-500 hover:bg-blue-100'}`}>
                                    {!uploadImage ? (
                                        <label className="flex flex-col items-center justify-center h-80 cursor-pointer hover:bg-blue-50 transition-colors">
                                            <div className="bg-white p-6 rounded-full shadow-lg shadow-blue-100 mb-4 transform hover:scale-110 transition-transform"><UploadIcon /></div>
                                            <h3 className="text-2xl font-bold text-blue-900 mb-2">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h3>
                                            <p className="text-slate-500">‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ ‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</p>
                                            <div className="mt-4 px-4 py-2 bg-blue-100 text-blue-700 rounded-full text-sm font-medium">{modelsLoaded ? systemStatus : "‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏£‡∏∞‡∏ö‡∏ö..."}</div>
                                            <input type="file" className="hidden" accept="image/*" onChange={handleFileUpload} disabled={!modelsLoaded} />
                                        </label>
                                    ) : (
                                        <div className="flex flex-col md:flex-row h-full">
                                            <div className="relative w-full md:w-1/3 h-80 md:h-auto bg-slate-900 flex items-center justify-center overflow-hidden scan-container">
                                                <img ref={imgRef} src={uploadImage} className="w-full h-full object-cover opacity-80" alt="Reference" crossOrigin="anonymous" onLoad={onImageLoad} />
                                                <canvas ref={canvasRef} id="overlay-canvas" />
                                                {isScanning && (
                                                    <div className="absolute inset-0 z-10">
                                                        <div className="scan-line"></div>
                                                        <div className="absolute bottom-8 left-0 right-0 text-center"><span className="bg-black/60 text-white px-6 py-2 rounded-full text-sm backdrop-blur-md shadow-lg">{systemStatus}</span></div>
                                                    </div>
                                                )}
                                                <button onClick={() => { setUploadImage(null); setSearchResults([]); setIsScanning(false); }} className="absolute top-4 right-4 bg-black/50 text-white p-2 rounded-full hover:bg-red-500 transition-colors z-20"><X /></button>
                                            </div>
                                            <div className="flex-1 p-8 flex flex-col justify-center items-center bg-white">
                                                {isScanning ? (
                                                    <div className="text-center space-y-6">
                                                        <div className="relative mx-auto w-20 h-20"><div className="w-20 h-20 border-4 border-blue-100 rounded-full"></div><div className="w-20 h-20 border-4 border-blue-600 border-t-transparent rounded-full animate-spin absolute top-0 left-0"></div></div>
                                                        <div><h3 className="text-xl font-bold text-slate-700">AI ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤...</h3><p className="text-slate-400 mt-2">{systemStatus}</p></div>
                                                    </div>
                                                ) : (
                                                    <div className="text-center space-y-4 w-full fade-in">
                                                        <div className="w-16 h-16 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-4 shadow-sm"><CheckCircle /></div>
                                                        <h3 className="text-2xl font-bold text-slate-800">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô!</h3>
                                                        <p className="text-slate-500">‡∏û‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô‡∏à‡∏≥‡∏ô‡∏ß‡∏ô <span className="text-blue-600 font-bold text-xl">{searchResults.length}</span> ‡∏£‡∏π‡∏õ</p>
                                                        <div className="flex gap-3 justify-center pt-6"><button onClick={handleDownloadAll} className="bg-blue-600 text-white px-8 py-3 rounded-xl font-medium shadow-lg shadow-blue-200 hover:bg-blue-700 transition-all hover:-translate-y-1 flex items-center gap-2"><Download /> ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button></div>
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    )}
                                </div>
                                {!isScanning && searchResults.length > 0 && (
                                    <div className="space-y-4 animate-fade-in-up">
                                        <div className="flex items-center justify-between"><h3 className="text-xl font-bold text-slate-700 flex items-center gap-2"><Grid /> ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</h3><span className="text-sm text-slate-400">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î</span></div>
                                        <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                            {searchResults.map((img, idx) => (
                                                <div key={idx} className="relative aspect-square rounded-xl overflow-hidden cursor-pointer transition-all hover:shadow-lg" onClick={() => handleDownload(img.url)}>
                                                    <img src={img.url} className="w-full h-full object-cover" alt="Result" />
                                                    <div className="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-3 opacity-0 hover:opacity-100 transition-opacity"><p className="text-white text-xs truncate">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô: {img.score}%</p></div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}
                    </main>
                    <footer className="bg-white border-t border-blue-100 mt-12 py-8"><div className="container mx-auto px-4 text-center text-slate-400 text-sm"><p>&copy; 2024 Hana photo Search System. All rights reserved.</p><p className="mt-2">Images sourced from Google Drive</p><p className="mt-1 text-xs">Created for GitHub: Thanatdenver123 | Netlify: tyodwong</p></div></footer>
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>